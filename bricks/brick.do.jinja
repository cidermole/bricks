{#
 # Basic brick.do shell script template, written in Jinja2
 # (see http://jinja.pocoo.org/docs/dev/templates/). This is
 # a Jinja2 comment that is not output into the generated file.
 #}

{#- *** Add notice about our origins to generated files. *** -#}

# If this shell script is called "brick.do", it was generated
# by "bricks.py" from templates and an experiment config file.

{#- *** End of notice. *** #}

# Instead of outputting each dependency as "redo-ifchange dependency",
# we collect them onto one "redo-ifchange", to improve parallelism.

(
{% block InputDependencies %}
    # input dependencies
    {%- for dependency in brick.inputDependencies() %}
        echo {{ dependency }}
    {%- endfor %}
{%- endblock %}

{% block OutputDependencies %}
    # output dependencies (for Bricks containing several parts)
    {%- for dependency in brick.outputDependencies() %}
        echo {{ dependency }}
    {%- endfor %}
{% endblock %}

    # need at least 1 command in case we have no dependencies
    true
) | xargs redo-ifchange

### Begin actual work ###

{% block Work %}
    # extend the template "brick.do.jinja" and override the
    # block Work to do something useful in this Brick.
{%- endblock %}

### End actual work ###

{% block Complete %}
    # mark as completed (stdout goes to our target file "brick")
    echo "{{ brick.path }}"
{%- endblock %}

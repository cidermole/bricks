{#
 # Basic brick.do shell script template, written in Jinja2
 # (see http://jinja.pocoo.org/docs/dev/templates/). This is
 # a Jinja2 comment that is not output into the generated file.
 #}

{#- *** Add notice about our origins to generated files. *** -#}

# If this shell script is called "brick.do", it was GENERATED
# by "bricks.py" from templates and an experiment config file.
# Please EDIT THE JINJA TEMPLATE instead. You've been warned.

{#- *** End of notice. *** #}

# Instead of outputting each dependency as "redo-ifchange dependency",
# we collect them onto one "redo-ifchange", to improve parallelism.

(
{% block Dependencies %}
    # dependencies
    {%- for dependency in brick.dependencies() %}
        echo {{ dependency }}
    {%- endfor %}
{%- endblock %}

{% if brick.dependencies() | length == 0 %}
    # we have no dependencies
    true
{% endif %}
) | xargs redo-ifchange

### Begin actual work ###

{% block Work %}
    # extend the template "brick.do.jinja" and override the
    # block Work to do something useful in this Brick.
{%- endblock %}

### End actual work ###

{% block Complete %}
    # mark as completed (stdout goes to our target file "brick")
    echo "{{ brick.path }}"
{%- endblock %}
